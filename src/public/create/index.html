<!DOCTYPE html>
<html>
    <head>
        <title>Create | EduHoot</title>
        <link rel="stylesheet" href = "../css/create.css">
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <link rel="icon" href="/icons/logo.svg" type="image/svg+xml">
    </head>
    <body>
        <a id = "back"href = "../" data-i18n="back">Volver</a>
        <div class="page-shell">
            <div class="top-row">
                <h1 id = "title" data-i18n="title">Crea y lanza tu EduHoot</h1>
                <div class="top-actions">
                    <label class="lang-switch">
                        <span data-i18n="langLabel">Idioma</span>
                        <select id="lang-select">
                            <option value="es" data-i18n="langEs">Español</option>
                            <option value="en" data-i18n="langEn">English</option>
                            <option value="ca" data-i18n="langCa">Català</option>
                        </select>
                    </label>
                    <button id="open-auth" type="button" class="btn btn-ghost btn-small" data-i18n="btnLogin">Entrar</button>
                </div>
            </div>
            <h4 id = "subtitle" data-i18n="subtitle">Genera con IA, importa (CSV o Kahoot) o <a id = "link" href = "quiz-creator/">crea un cuestionario desde cero</a>.</h4>

            <div id="auth-modal" class="modal hidden" role="dialog" aria-modal="true">
                <div class="modal__backdrop" data-modal-close></div>
                <div class="modal__content" role="document">
                    <button id="auth-modal-close" type="button" class="btn btn-ghost btn-small modal__close" data-i18n="modalClose" data-modal-close>Cerrar</button>
                    <div id="auth-panel" class="panel">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow" data-i18n="accessEyebrow">Acceso</p>
                        <h3 data-i18n="accessTitle">Usuarios</h3>
                        <p class="subtext" data-i18n="accessDesc">Inicia sesión para crear, editar o borrar quizzes.</p>
                    </div>
                </div>
                <div class="auth-grid">
                    <label data-i18n="labelEmail">Email
                        <input id="auth-email" type="email" placeholder="tupro@centro.es">
                    </label>
                    <label data-i18n="labelPass">Contraseña
                        <input id="auth-pass" type="password" placeholder="••••••••">
                    </label>
                    <label data-i18n="labelNick">Nombre visible (opcional)
                        <input id="auth-nick" type="text" placeholder="Tu nick público">
                    </label>
                </div>
                <div class="actions-row">
                    <button id="auth-login" class="btn btn-primary" data-i18n="btnLogin">Entrar</button>
                    <button id="auth-save-nick" class="btn btn-ghost" data-i18n="btnSaveNick">Guardar nombre visible</button>
                </div>
                <p class="subtext" id="auth-message"></p>
                <div class="actions-row">
                    <button id="toggle-reset" class="btn btn-ghost" data-i18n="forgotPass">¿Olvidaste la contraseña?</button>
                </div>
                <div id="reset-panel" class="subpanel hidden">
                    <p class="eyebrow" data-i18n="resetEyebrow">Recuperar acceso</p>
                    <p class="subtext" data-i18n="resetDesc">Te enviaremos un token (se registra en el log del servidor si no hay correo configurado). Luego úsalo para poner una nueva contraseña.</p>
                    <div class="auth-grid">
                        <label data-i18n="labelEmail">
                            <input id="reset-email" type="email" placeholder="tu correo">
                        </label>
                    </div>
                    <div class="actions-row">
                        <button id="reset-request" class="btn btn-primary" data-i18n="btnGenToken">Generar token</button>
                        <span id="reset-status" class="subtext"></span>
                    </div>
                    <div class="auth-grid">
                        <label data-i18n="labelToken">Token recibido
                            <input id="reset-token" type="text" placeholder="copia el token del email/log">
                        </label>
                        <label data-i18n="labelNewPass">Nueva contraseña
                            <input id="reset-pass" type="password" placeholder="••••••••">
                        </label>
                    </div>
                    <div class="actions-row">
                        <button id="reset-confirm" class="btn btn-ghost" data-i18n="btnChangePass">Cambiar contraseña</button>
                    </div>
                </div>
                <div id="user-admin" class="subpanel hidden">
                    <p class="eyebrow" data-i18n="adminOnly">Solo admins</p>
                    <h4 data-i18n="createUser">Crea un usuario nuevo</h4>
                    <div class="auth-grid">
                        <label data-i18n="labelEmail">
                            <input id="new-user-email" type="email" placeholder="nuevo@centro.es">
                        </label>
                        <label data-i18n="labelPass">
                            <input id="new-user-pass" type="password" placeholder="••••••••">
                        </label>
                        <label data-i18n="labelNick">
                            <input id="new-user-nick" type="text" placeholder="Nick público (opcional)">
                        </label>
                        <label data-i18n="labelRole">Rol
                            <select id="new-user-role">
                                <option value="editor" data-i18n="roleEditor">Editor</option>
                                <option value="admin" data-i18n="roleAdmin">Admin</option>
                            </select>
                        </label>
                    </div>
                    <div class="actions-row">
                        <button id="create-user-btn" class="btn btn-ghost" data-i18n="btnCreateUser">Crear usuario</button>
                        <span id="create-user-status" class="subtext"></span>
                    </div>
                    <div class="auth-grid">
                        <label data-i18n="labelEmailReset">Email a resetear
                            <input id="reset-admin-email" type="email" placeholder="usuario@centro.es">
                        </label>
                        <label data-i18n="labelNewPass">
                            <input id="reset-admin-pass" type="password" placeholder="••••••••">
                        </label>
                    </div>
                    <div class="actions-row">
                        <button id="reset-admin-btn" class="btn btn-ghost" data-i18n="btnResetPass">Resetear contraseña</button>
                        <span id="reset-admin-status" class="subtext"></span>
                    </div>
                </div>
            </div>

                </div>
            </div>

            <details id="ia-box" class="panel">
                <summary class="panel-summary">
                    <div class="panel-header">
                        <div>
                            <p class="eyebrow" data-i18n="aiEyebrow">Ayuda IA</p>
                            <h3 data-i18n="aiTitle">Generador IA (CSV)</h3>
                            <p class="subtext" data-i18n="aiDesc">Rellena los campos y copia el prompt para generar tu cuestionario por IA.</p>
                        </div>
                    </div>
                </summary>

                <div class="ia-grid">
                    <label data-i18n="iaNameLabel">Nombre del quiz (opcional)
                        <input id="ia-name" type="text" placeholder="Nombre para guardar">
                    </label>
                    <label data-i18n="iaLevel">Nivel del alumnado
                        <input id="ia-nivel" type="text" placeholder="Ej: 2º ESO">
                    </label>
                    <label data-i18n="iaTopic">Tema del cuestionario
                        <input id="ia-tema" type="text" placeholder="Ej: Energía y calor">
                    </label>

                    <label data-i18n="iaLang">Idioma del cuestionario
                        <select id="ia-idioma">
                            <option value="Español" data-i18n="optSpanish">Español</option>
                            <option value="Catalán" data-i18n="optCatalan">Catalán</option>
                            <option value="Inglés" data-i18n="optEnglish">Inglés</option>
                            <option value="otro" data-i18n="optOther">Otro</option>
                        </select>
                        <input id="ia-idioma-custom" class="hidden" type="text" placeholder="Otro idioma">
                    </label>
                    <label data-i18n="iaNum">Número de preguntas
                        <input id="ia-num" type="number" min="1" max="50" value="10">
                    </label>
                    <label data-i18n="iaExtra">Instrucciones adicionales
                        <textarea id="ia-extra" rows="2" placeholder="Tono, nivel cognitivo, formato..."></textarea>
                    </label>
                </div>

                <div class="subpanel">
                    <label class="checkbox-inline">
                        <input type="checkbox" id="ia-use-docs">
                        <span data-i18n="iaUseDocs">Usar documentos como conocimiento exclusivo</span>
                    </label>
                    <p id="ia-docs-hint" class="subtext hidden" data-i18n="iaDocsHint">Cuando ejecutes este prompt en la IA, te pedirá que adjuntes los documentos. No subas nada aquí: adjunta los archivos allí y las preguntas se generarán exclusivamente a partir de esos documentos.</p>
                </div>

                <div class="subpanel">
                    <p class="eyebrow" data-i18n="iaTypesLabel">Tipos de pregunta</p>
                    <label class="checkbox-inline">
                        <input type="checkbox" id="ia-type-quiz" checked>
                        <span data-i18n="iaTypeQuiz">Quiz (1 correcta)</span>
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" id="ia-type-multiple">
                        <span data-i18n="iaTypeMultiple">Respuesta Múltiple</span>
                    </label>
                    <label class="checkbox-inline">
                        <input type="checkbox" id="ia-type-tf">
                        <span data-i18n="iaTypeTf">Verdadero / Falso</span>
                    </label>
                </div>

                <div class="actions-row">
                    <button id="ia-generate" type="button" data-i18n="btnGenPrompt">Generar prompt</button>
                    <button id="ia-copy" type="button" class="secondary" data-i18n="btnCopyPrompt">Copiar prompt</button>
                </div>
                <pre id="ia-prompt" data-i18n="promptPlaceholder">El prompt aparecerá aquí...</pre>

                <label data-i18n="iaCsvLabel">Contenido CSV generado por la IA
                    <textarea id="ia-csv" rows="6" placeholder="Pega aquí el CSV devuelto por la IA"></textarea>
                </label>
                <input id="ia-csv-file" type="file" accept=".csv,text/csv" class="hidden">

                <div class="actions-row">
                    <button id="ia-open" class="btn btn-ghost" type="button" data-i18n="btnOpenCsv">Abrir CSV</button>
                    <button id="ia-download" class="btn btn-ghost" type="button" data-i18n="btnDownloadCsv">Descargar CSV</button>
                    <button id="ia-preview" class="btn btn-ghost" type="button" data-i18n="btnPreviewCsv">Vista previa</button>
                </div>

                <div id="ia-preview-box" class="subpanel hidden">
                    <p class="eyebrow" data-i18n="previewTitle">Vista previa</p>
                    <div id="ia-preview-content" class="ia-preview"></div>
                </div>

                <div class="actions-row">
                    <button id="ia-upload" type="button" data-i18n="btnImportIa">Importar CSV en el cuestionario</button>
                    <button id="ia-edit" class="btn btn-ghost" type="button" data-i18n="btnEditCreator" disabled>Editar en creador</button>
                </div>
                <p id="ia-status"></p>
            </details>

            <details id="csv-import" class="panel">
                <summary class="panel-summary">
                    <div class="panel-header">
                        <div>
                            <p class="eyebrow" data-i18n="importEyebrow">Importación</p>
                            <h3 data-i18n="importTitle">Importar cuestionario (CSV o Kahoot público)</h3>
                            <p class="subtext" data-i18n="importDesc">Sube un archivo CSV con tus preguntas para guardarlo en tu biblioteca.</p>
                        </div>
                    </div>
                </summary>
            <form id="csv-form">
                <input id="csv-file" type="file" accept=".csv,text/csv" required>
                <input id="csv-name" type="text" placeholder="Nombre del quiz (opcional)">
                <button type="submit" data-i18n="btnUploadCsv">Subir CSV</button>
            </form>
            <p id="csv-status"></p>
            <div class="split-import">
                <div>
                    <h3 data-i18n="kahootTitle">Importar Kahoot público</h3>
                    
                    <p class="subtext" data-i18n="kahootHelp">Pega la URL o el ID de un Kahoot público.</p>
                    <br>
                    <form id="kahoot-form">
                        <input id="kahoot-url" type="text" inputmode="url" autocomplete="off" placeholder="https://create.kahoot.it/details/..." required>
                        <select id="kahoot-visibility">
                            <option value="public" data-i18n="visibilityPublic">Público</option>
                            <option value="unlisted" data-i18n="visibilityUnlisted">Por enlace/ID</option>
                            <option value="private" data-i18n="visibilityPrivate">Solo yo (privado)</option>
                        </select>
                        <button type="submit" data-i18n="btnImportKahoot">Importar desde Kahoot</button>
                    </form>
                    <p id="kahoot-status" class="subtext"></p>
                </div>
            </div>
            </details>

            <div id="library" class="panel">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow" data-i18n="libraryEyebrow">Biblioteca</p>
                        <h3 data-i18n="libraryTitle">Cuestionarios importados</h3>
                        <p class="subtext" data-i18n="libraryDesc">Selecciona un cuestionario para hostearlo o gestiona su nombre y estado.</p>
                    </div>
                    <div id="game-count" class="pill pill-muted">0 cuestionarios</div>
                </div>
                <div class="filter-bar extra-gap">
                    <input id="library-search" type="search" placeholder="Buscar por nombre o etiqueta">
                </div>
                <div id="filter-bar" class="filter-bar">
                    <div class="pill pill-muted" id="filter-info" data-i18n="noFilters">Sin filtros</div>
                    <label class="checkbox-inline">
                        <input type="checkbox" id="filter-mine">
                        <span data-i18n="filterMine">Sólo mis cuestionarios</span>
                    </label>
                </div>
                <div id="tag-suggestions" class="tag-suggestions"></div>
                <p class="subtext" data-i18n="visibilityHelp">
                    <strong>Solo yo:</strong> si no inicias sesión, el quiz se guarda solo en tu sesión y caduca en 24h.<br>
                    <strong>Por enlace / Público:</strong> aunque no tengas cuenta, se guardan de forma global en el servidor y sobreviven a reinicios. Si inicias sesión, quedan ligados a tu usuario.
                    Puedes permitir o no las copias.
                </p>
                <div id="game-list" class="game-grid">
                </div>
                <div id="library-pagination" class="pagination hidden">
                    <button id="library-pagination-prev" class="btn btn-ghost" data-i18n="paginationPrev">Anterior</button>
                    <span id="library-pagination-info"></span>
                    <button id="library-pagination-next" class="btn btn-ghost" data-i18n="paginationNext">Siguiente</button>
                </div>
            </div>
        </div>
        
        <script src = "../socket.io/socket.io.js"></script>
        <script src = "../js/create.js"></script>
    </body>
</html>

<!DOCTYPE html>
<html>
    <head>
        <title>Creator | EduHoot</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel = "stylesheet" href = "../../css/quizCreator.css">
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    </head>
    <body>
        <a id="back" href="../" data-i18n="back">Volver</a>
        <div class="page-shell">
            <div class="top-row">
                <h1 id="title" data-i18n="title">Creador de quizzes</h1>
                <label class="lang-switch">
                    <span data-i18n="langLabel">Idioma</span>
                    <select id="lang-select">
                        <option value="es">Español</option>
                        <option value="en">English</option>
                        <option value="ca">Català</option>
                    </select>
                </label>
            </div>
            <h4 id="subtitle" data-i18n="subtitle">Diseña las preguntas y guarda tu juego para lanzarlo cuando quieras.</h4>

            <div class="panel">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow" data-i18n="configEyebrow">Configuración</p>
                        <h3 data-i18n="configTitle">Datos del quiz</h3>
                        <p class="subtext" data-i18n="configDesc">Ponle un nombre para identificarlo en la biblioteca.</p>
                    </div>
                </div>
                <div class="form-field">
                    <label id="quizTitle" for="name" data-i18n="quizTitle">Título del quiz</label>
                    <input id="name" type="text" name="name" placeholder="Ej: Repaso de energía" autofocus/>
                </div>
                <div class="form-field">
                    <label for="tags" data-i18n="tagsLabel">Etiquetas (separadas por comas)</label>
                    <input id="tags" type="text" name="tags" placeholder="ej: física, 2ºESO, energía">
                </div>
                <div id="tag-suggestions" class="tag-suggestions"></div>
                <div class="form-field">
                    <label for="visibility" data-i18n="visibilityLabel">Visibilidad del quiz</label>
                    <select id="visibility" name="visibility">
                        <option value="private" data-i18n="visibilityPrivate">Solo yo (privado)</option>
                        <option value="unlisted" data-i18n="visibilityUnlisted">Por enlace/ID</option>
                        <option value="public" data-i18n="visibilityPublic">Público en la biblioteca</option>
                    </select>
                    <p id="public-warning" class="visibility-warning hidden" data-i18n="publicWarning">Al publicar el quiz se guardará como parte de la biblioteca global y no podrás editarlo después sin sesión.</p>
                </div>
                <div class="form-field inline">
                    <label for="allow-clone" class="checkbox-label" data-i18n="allowCloneLabel">
                        <input id="allow-clone" type="checkbox"> Permitir que otras personas hagan una copia
                    </label>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow" data-i18n="questionsEyebrow">Preguntas</p>
                        <h3 data-i18n="questionsTitle">Construye las preguntas</h3>
                        <p class="subtext" data-i18n="questionsDesc">Añade 4 posibles respuestas y marca la correcta (1-4).</p>
                    </div>
                    <button class="btn btn-ghost" onclick="addQuestion()" data-i18n="addQuestion">+ Añadir pregunta</button>
                </div>
                <div id="allQuestions" class="question-grid"></div>
            </div>

            <div class="panel actions">
                <div class="actions-row">
                    <button class="btn btn-primary" onclick="updateDatabase()" data-i18n="btnSave">Guardar quiz</button>
                    <button class="btn btn-ghost" onclick="saveLocal()" data-i18n="btnPlayLocal">Jugar sin guardar</button>
                    <button class="btn btn-ghost" onclick="exportCsv()" data-i18n="btnExportCsv">Exportar CSV</button>
                    <button class="btn btn-ghost" onclick="exportPdf()"><span data-i18n="btnExportPdf">Exportar PDF</span> <img class="btn-icon" src="/icons/pdf.jpeg" alt="" aria-hidden="true"></button>
                    <button class="btn btn-ghost" onclick="exportPdf({ includeAnswers: false })"><span data-i18n="btnExportPdfNoAnswers">Exportar PDF (sin respuestas)</span> <img class="btn-icon" src="/icons/pdf.jpeg" alt="" aria-hidden="true"></button>
                    <button class="btn btn-ghost" onclick="exportMoodleXml()"><span data-i18n="btnExportMoodleXml">Exportar XML (Moodle)</span> <span aria-hidden="true">↓</span></button>
                    <button class="btn btn-ghost" onclick="cancelQuiz()" data-i18n="btnCancel">Cancelar y volver</button>
                </div>
                <p class="subtext" data-i18n="localInfo">
                    Sin sesión: “Guardar” o “Jugar sin guardar” crean un quiz anónimo.<br>
                    - Si eliges <strong>Solo yo</strong> caduca en 24h.<br>
                    - Si eliges <strong>Por enlace/Público</strong> se guarda globalmente y persiste tras reinicios.<br>
                    Con sesión iniciada, se guardan en tu usuario.
                </p>
            </div>

            <p class="subtext sw-version" id="sw-version" aria-live="polite"></p>
        </div>

        <div id="moodleModal" class="moodle-modal hidden" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="moodleModalTitle">
            <div class="moodle-modal__content">
                <h3 id="moodleModalTitle" data-i18n="moodleModalTitle">Importar en Moodle</h3>
                <p data-i18n="moodleModalDescription">Revisa estos pasos antes de descargar el XML para subirlo a tu curso.</p>
                <ol>
                    <li data-i18n="moodleModalStep1">Accede al curso de Moodle donde quieres importar el quiz.</li>
                    <li data-i18n="moodleModalStep2">Ve a Administración del curso > Importar y selecciona el tipo "Moodle XML".</li>
                    <li data-i18n="moodleModalStep3">Sube el archivo descargado y sigue el asistente para confirmar las preguntas.</li>
                </ol>
                <div class="moodle-modal__actions">
                    <button id="moodleModalCancel" class="btn btn-ghost" data-i18n="moodleModalCancel">Cerrar</button>
                    <button id="moodleModalConfirm" class="btn btn-primary" data-i18n="moodleModalConfirm">Descargar XML</button>
                </div>
            </div>
        </div>

        <script src = "../../socket.io/socket.io.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.2/dist/jspdf.umd.min.js"></script>
        <script src = "../../js/quizCreator.js"></script>
        <script src="/js/sw-version.js"></script>
    </body>
</html>
